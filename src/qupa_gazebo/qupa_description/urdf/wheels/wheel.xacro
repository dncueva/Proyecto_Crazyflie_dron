<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="$(arg tf_prefix)">
    
    <!--Xacro Wheel Dynamics Properties-->
    <xacro:property name="wheel_friction_mu" value="1.0" />
    <xacro:property name="wheel_friction_mu2" value="1.0" />
    <xacro:property name="contact_kp" value="100000.0" />
    <xacro:property name="contact_kd" value="10.0" />
    <xacro:property name="max_contact_vel" value="0.1" />
    <xacro:property name="min_contact_depth" value="0.01" />
    <xacro:property name="joint_effort" value="10.0" />
    <xacro:property name="wheel_damping" value="0.7" />
    <xacro:property name="wheel_friction" value="0.5" />
    <xacro:property name="scale" value="0.0010 0.0010 0.001"/>

    <xacro:macro name="wheel" 
    params="wheel_name 
            wheel_joint_name 
            wheel_parent_name
            wheel_joint_origin_xyz 
            wheel_joint_origin_rpy">
    
    <link name="${wheel_name}">
      <inertial>
            <origin
            xyz="-0.000 0.000017 0.000973"
            rpy="0 0 0" />
            <mass value="0.0004" />
            <inertia
            ixx="4.5674E-07"
            ixy="5.7632E-11"
            ixz="-2.5373E-15"
            iyy="2.392E-07"
            iyz="4.8406E-12"
            izz="2.39E-07" />
        </inertial>
      <visual>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <mesh filename="package://qupa_description/meshes/wheel.dae" scale="${scale}"/>
        </geometry>
      <material name="dark"/>
      </visual>
      <collision>
        <origin xyz="0 0 0" rpy="0 0 0" />
        <geometry>
          <cylinder radius="0.016" length="0.006"/>
        </geometry>
      </collision>
    </link>
    <joint name="${wheel_joint_name}" type="continuous">
      <origin xyz="${wheel_joint_origin_xyz}" rpy="${wheel_joint_origin_rpy}" />
      <parent link="${wheel_parent_name}" />
      <child link="${wheel_name}" />
      <xacro:if value="${wheel_joint_name == 'L_wheel_joint'}">
        <axis xyz="0 0 -1" />
      </xacro:if>
      <xacro:unless value="${wheel_joint_name == 'L_wheel_joint'}">
        <axis xyz="0 0 1" />
      </xacro:unless>
      <limit effort="${joint_effort}" velocity="1.0" />
      <dynamics damping="${wheel_damping}" friction="${wheel_friction}" />
    </joint>
    <gazebo reference="${wheel_name}">
      <mu>${wheel_friction_mu}</mu> 
      <mu2>${wheel_friction_mu2}</mu2>
      <kp>${contact_kp}</kp>
      <kd>${contact_kd}</kd>
      <maxVel>${max_contact_vel}</maxVel>
      <minDepth>${min_contact_depth}</minDepth>
    </gazebo>
  </xacro:macro>
</robot>